<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - Advanced Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Professional Background & Layout */
        body { background-color: #f0f4f8; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        /* Frozen/Sticky Header */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: #ffffff; 
            padding: 20px 10px;
            border-bottom: 3px solid #3498db; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
        }

        /* Stats Bar Styling */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 5px solid #3498db;
        }
        .stat-card h4 { margin: 0; color: #7f8c8d; font-size: 0.9rem; text-transform: uppercase; }
        .stat-card p { margin: 5px 0 0; font-size: 1.8rem; font-weight: bold; color: #2c3e50; }

        /* Filter Section Styling */
        .filter-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            background: #f1f4f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            align-items: end;
            border: 1px solid #dce4ec;
        }
        .filter-container input, .filter-container select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            width: 100%;
            box-sizing: border-box;
        }

        .filter-box label {
            display: block;
            font-size: 11px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        /* Nav & Dashboard Styling */
        .nav-menu { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .nav-item { cursor: pointer; padding: 8px 18px; border-radius: 20px; font-weight: bold; color: #7f8c8d; transition: 0.3s; }
        .nav-item:hover, .nav-item.active { background: #3498db; color: white; }
        
        .dashboard-card { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); max-width: 1300px; margin: 20px auto; padding: 20px; }
        
        .btn-modify { background-color: #3498db; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px; }
        .btn-delete { background-color: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        
        .btn-clear { background-color: #95a5a6; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 14px; width: 100%; }

        /* Leave Status Badges */
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .pending { background: #fff3cd; color: #856404; }
        .approved { background: #d4edda; color: #155724; }
        .rejected { background: #f8d7da; color: #721c24; }

        /* Report Management Styles */
        .report-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 10px; }
        .report-card { background: #fff; border: 1px solid #e0e6ed; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .report-card h3 { margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 8px; display: inline-block; margin-bottom: 15px; }
        
        .report-result-container { margin-top: 30px; border-top: 2px dashed #ccc; padding-top: 20px; display: none; }

        /* Print Mode Optimization */
        @media print {
            @page { size: landscape; }
            .sticky-header, .stats-bar, .filter-container, .nav-menu, .dashboard-buttons, .report-grid, .btn-modify, .btn-delete, .btn-clear, .report-actions, .no-print, .search-bar-container, .bulk-actions { display: none !important; }
            body { background: white; }
            .dashboard-card { box-shadow: none; margin: 0; width: 100%; }
            #reportSection, .report-result-container { display: block !important; }
            .print-only { display: block !important; }
        }
        
        .print-only { display: none; margin-top: 50px; font-weight: bold; }
        .search-bar-container { margin: 15px 0; }
        .search-bar-container input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }

        /* NEW STYLE: Bulk Actions and Summary */
        .bulk-actions { background: #fff; padding: 10px; margin-bottom: 10px; border: 1px solid #eee; display: flex; gap: 10px; align-items: center; border-radius: 5px; }
        .summary-box { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; border-radius: 5px; margin-bottom: 20px; display: none; }
    </style>
</head>
<body>
<div class="app">
    <div class="card dashboard-card">
        
        <div class="sticky-header">
            <h1 style="text-align: center; margin: 0;">ðŸ‘¤ Admin Dashboard</h1>
            <div class="datetime" style="margin: 10px 0;">
                <span id="liveDate" style="display: block; text-align: center; font-weight: bold; color: #7f8c8d;">Date</span>
                <span id="liveTime" style="display: block; text-align: center; font-size: 1.4rem; font-weight: bold; color: #3498db;">Time</span>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item active" onclick="showSection('registrationSection', this)">Staff Management</div>
                <div class="nav-item" onclick="showSection('attendanceSection', this)">Attendance History</div>
                <div class="nav-item" onclick="showSection('leaveRequestSection', this)">Leave Requests</div> 
                <div class="nav-item" style="color: #000000;" onclick="showSection('reportSection', this)">Report Management</div>
            </div>

            <div class="dashboard-buttons" style="display: flex; justify-content: center; gap: 10px;">
                <button class="btn warning" onclick="adminLogout()">Logout</button>
            </div>
        </div>

      <div class="stats-bar">
    <div class="stat-card">
        <h4>Total Staff</h4>
        <p id="statTotalStaff">0</p>
    </div>
    <div class="stat-card">
        <h4>Present Today</h4>
        <p id="statPresent">0</p>
    </div>
    <div class="stat-card absent-card">
        <h4>On Leave / Off</h4>
        <p id="statAbsent">0</p>
    </div>
    <div class="stat-card">
        <h4>Night Shift</h4>
        <p id="statSecondShift">0</p>
    </div>
</div>

        <div id="registrationSection">
            <div class="section-header-container">
                <h2>âž• Register New Staff</h2>
            </div>
            <div class="form-group">
                <input type="text" id="staffName" placeholder="Staff Name">
                <input type="text" id="staffID" placeholder="Employee ID">
                <input type="text" id="staffRole" placeholder="Position / Role">
                <input type="text" id="staffContact" placeholder="Contact Number">
                <input type="text" id="staffNIC" placeholder="NIC Number">
                <input type="password" id="staffPassword" placeholder="Password">
                <button class="btn primary" id="regBtn" onclick="registerStaff()" style="width: 100%; margin-top: 10px;">Register Staff</button>
            </div>

            <div class="search-bar-container">
                <input type="text" id="staffSearch" placeholder="Search registered staff by Name or ID..." onkeyup="searchStaffTable()">
            </div>

            <h3>Registered Staff List</h3>
            <div class="table-wrapper">
                <table id="staffTable">
                    <thead>
                        <tr>
                            <th>Name</th><th>ID</th><th>Role</th><th>Contact</th><th>NIC</th><th>Password</th><th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="attendanceSection" style="display:none;">
            <h3 class="admin-section-title">Staff Attendance History</h3>

            <div class="filter-container">
                <div class="filter-box">
                    <label>Name</label>
                    <input type="text" id="filterName" placeholder="Search Name" onkeyup="filterAttendance()">
                </div>
                <div class="filter-box">
                    <label>ID</label>
                    <input type="text" id="filterID" placeholder="Search ID" onkeyup="filterAttendance()">
                </div>
                <div class="filter-box">
                    <label>Specific Date</label>
                    <input type="date" id="filterSpecificDate" onchange="filterAttendance()">
                </div>
                <div class="filter-box">
                    <label>Floor</label>
                    <select id="filterFloor" onchange="filterAttendance()">
                        <option value="">All Floors</option>
                        <option value="29">Floor 29</option>
                        <option value="31">Floor 31</option>
                        <option value="32">Floor 32</option>
                        <option value="33">Floor 33</option>
                        <option value="MT28">Floor MT28</option>
                    </select>
                </div>
                <div class="filter-box">
                    <label>Shift</label>
                    <select id="filterShift" onchange="filterAttendance()">
                        <option value="">All Shifts</option>
                        <option value="Day">Day</option>
                        <option value="Night">Night</option>
                        <option value="2nd Shift">2nd Shift Only</option>
                    </select>
                </div>
                <div class="filter-box">
                    <button class="btn-clear" onclick="clearFilters()">Clear Filters</button>
                </div>
            </div>
            
            <div class="table-wrapper">
                <table id="adminAttendanceTable">
                    <thead>
                        <tr>
                            <th>Staff Name (ID)</th>
                            <th>Date</th>
                            <th>Floor</th>
                            <th>Shift</th>
                            <th>In</th>
                            <th>Out</th>
                            <th>Duration</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div style="margin-top: 10px; text-align: right;">
                <button class="btn-delete" style="padding: 10px;" onclick="confirmClearHistory()">Clear All Attendance History</button>
            </div>
        </div>

        <div id="leaveRequestSection" style="display:none;">
            <h3 class="admin-section-title">Leave Request Management (Admin Final Approval)</h3>
            
            <div class="bulk-actions">
                <span>Bulk Action:</span>
                <button class="btn-modify" style="background:#2ecc71" onclick="bulkProcessLeaves('Approved')">Approve Selected</button>
                <button class="btn-delete" style="background:#e67e22" onclick="bulkProcessLeaves('Rejected')">Reject Selected</button>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllLeaves" onclick="toggleSelectAll(this)"></th>
                            <th>Staff Name (ID)</th>
                            <th>Leave Type</th>
                            <th>Duration (Range)</th>
                            <th>Total Days</th>
                            <th>Mgt. Status</th>
                            <th>Final Admin Action</th>
                        </tr>
                    </thead>
                    <tbody id="adminLeaveRequestBody">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="reportSection" style="display:none;">
            <h3 class="admin-section-title">Report Management</h3>
            
            <div class="filter-container" style="background: #eef2f7; border: 1px solid #d1d9e6; display: flex; gap: 15px; align-items: center; padding: 15px; margin-top: 10px; grid-template-columns: none;">
                <div style="flex: 2; display: flex; gap: 10px; align-items: center;">
                    <strong>Daily:</strong>
                    <input type="date" id="reportDailyDate" style="height: 45px; border: 1px solid #ccc; border-radius: 4px; padding: 0 10px; width: auto;">
                    <select id="reportDailyShift" style="height: 45px; border: 1px solid #ccc; border-radius: 4px; width: auto;">
                        <option value="All Shifts">All Shifts</option>
                        <option value="Day">Day</option>
                        <option value="Night">Night</option>
                    </select>
                    <button class="secondary" style="width: auto; height: 45px; margin: 0; padding: 0 20px; cursor: pointer; background: #3498db; color: white; border: none; border-radius: 4px; font-weight: bold;" onclick="generateReport('daily', 'view')">Generate Daily Sheet</button>
                </div>

                <div style="flex: 1.5; display: flex; gap: 10px; align-items: center; justify-content: flex-end;">
                    <strong>Monthly:</strong>
                    <input type="month" id="reportMonthlyDate" style="height: 45px; border: 1px solid #ccc; border-radius: 4px; padding: 0 10px; width: auto;">
                    <button class="warning" style="width: auto; height: 45px; margin: 0; padding: 0 20px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;" onclick="generateReport('monthly', 'view')">Generate Monthly Sheet</button>
                </div>
            </div>

            <div id="reportSummary" class="summary-box">
                <h4 style="margin-top:0">Report Summary Insights</h4>
                <div style="display:flex; gap: 30px;">
                    <div id="sumTotalPresent">Present: 0</div>
                    <div id="sumAttendanceRate">Attendance Rate: 0%</div>
                </div>
            </div>

            <div id="reportResultArea" class="report-result-container">
                <div class="no-print" style="margin-bottom: 15px; text-align: right;">
                    <button class="btn-report btn-csv" style="width: auto; padding: 10px 20px;" onclick="exportToCSV()">Download CSV (Excel)</button>
                </div>
                <h3 id="reportTitleDisplay">Report Details</h3>
                <div class="table-wrapper">
                    <table id="reportDetailTable">
                        <thead>
                            <tr>
                                <th>Staff Name (ID)</th>
                                <th>Date</th>
                                <th>Floor</th>
                                <th>Shift</th>
                                <th>In</th>
                                <th>Out</th>
                                <th>Duration</th>
                            </tr>
                        </thead>
                        <tbody id="reportResultBody"></tbody>
                    </table>
                </div>

                <div class="print-only">
                    <div style="display: flex; justify-content: space-between; margin-top: 80px;">
                        <div style="border-top: 1px solid black; width: 200px; text-align: center;">Authorized Signature</div>
                        <div style="border-top: 1px solid black; width: 200px; text-align: center;">Admin Stamp</div>
                    </div>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn secondary no-print" style="background: #8e44ad; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;" onclick="window.print()">Print Current Sheet</button>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="script.js"></script>
<script>
    // New Feature: Search Staff Table
    function searchStaffTable() {
        const input = document.getElementById("staffSearch");
        const filter = input.value.toLowerCase();
        const table = document.getElementById("staffTable");
        const tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
            const tdName = tr[i].cells[0].textContent.toLowerCase();
            const tdID = tr[i].cells[1].textContent.toLowerCase();
            tr[i].style.display = (tdName.includes(filter) || tdID.includes(filter)) ? "" : "none";
        }
    }

    // New Feature: Confirm Clear History
    function confirmClearHistory() {
        if(confirm("Are you sure you want to PERMANENTLY delete all attendance records? This cannot be undone.")) {
            const staffList = JSON.parse(localStorage.getItem("staffList")) || [];
            staffList.forEach(staff => {
                localStorage.removeItem("attendance_" + staff.empID);
            });
            alert("All history cleared.");
            location.reload();
        }
    }

    // New Feature: Export report to CSV
    function exportToCSV() {
        const table = document.getElementById("reportDetailTable");
        let csv = [];
        for (let i = 0; i < table.rows.length; i++) {
            let row = [], cols = table.rows[i].cells;
            for (let j = 0; j < cols.length; j++) 
                row.push('"' + cols[j].innerText + '"');
            csv.push(row.join(","));
        }
        const csvContent = "data:text/csv;charset=utf-8," + csv.join("\n");
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "Attendance_Report.csv");
        link.setAttribute("document.body.appendChild(link)");
        link.click();
    }

    function showSection(sectionId, element) {
        document.getElementById('registrationSection').style.display = 'none';
        document.getElementById('attendanceSection').style.display = 'none';
        document.getElementById('reportSection').style.display = 'none';
        document.getElementById('leaveRequestSection').style.display = 'none'; 
        document.getElementById(sectionId).style.display = 'block';
        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
        element.classList.add('active');
        
        if(sectionId === 'attendanceSection') {
            if(typeof displayAllAttendance === "function") displayAllAttendance();
        }
        if(sectionId === 'registrationSection') {
            if(typeof displayStaffList === "function") displayStaffList();
        }
        if(sectionId === 'leaveRequestSection') {
            displayAdminLeaves();
        }
    }

    // UPDATED: Multi-Date & Re-approval Logic for Admin
    function displayAdminLeaves() {
        const leaveBody = document.getElementById("adminLeaveRequestBody");
        const allRequests = JSON.parse(localStorage.getItem("allLeaveRequests")) || [];
        
        leaveBody.innerHTML = "";

        if (allRequests.length === 0) {
            leaveBody.innerHTML = "<tr><td colspan='7' style='text-align:center;'>No leave requests found.</td></tr>";
            return;
        }

        allRequests.slice().reverse().forEach((req, index) => {
            const realIndex = allRequests.length - 1 - index;
            const statusClass = req.status.toLowerCase();
            
            leaveBody.innerHTML += `
                <tr>
                    <td><input type="checkbox" class="leave-check" data-index="${realIndex}"></td>
                    <td>${req.staffName} (${req.empID})</td>
                    <td>${req.type}</td>
                    <td>${req.startDate || req.date} to ${req.endDate || req.date}</td>
                    <td><strong>${req.totalDays || 1} Days</strong></td>
                    <td><span class="status-badge ${statusClass}">${req.status}</span></td>
                    <td>
                        <button class="btn-modify" style="background:#2ecc71" onclick="processLeave(${realIndex}, 'Approved')">Final Approve</button>
                        <button class="btn-delete" style="background:#e67e22" onclick="processLeave(${realIndex}, 'Rejected')">Final Reject</button>
                        <button class="btn-delete" style="margin-left:5px;" onclick="deleteLeaveRequest(${realIndex})">Delete Record</button>
                    </td>
                </tr>
            `;
        });
    }

    // NEW LOGIC: Bulk Processing
    function toggleSelectAll(master) {
        const checks = document.querySelectorAll('.leave-check');
        checks.forEach(c => c.checked = master.checked);
    }

    function bulkProcessLeaves(status) {
        const selected = document.querySelectorAll('.leave-check:checked');
        if(selected.length === 0) return alert("Select at least one request.");
        
        if(confirm(`Set ${selected.length} requests to ${status}?`)) {
            let allRequests = JSON.parse(localStorage.getItem("allLeaveRequests")) || [];
            selected.forEach(box => {
                const idx = box.getAttribute('data-index');
                allRequests[idx].status = status;
                allRequests[idx].adminFinalized = true;
            });
            localStorage.setItem("allLeaveRequests", JSON.stringify(allRequests));
            displayAdminLeaves();
            document.getElementById('selectAllLeaves').checked = false;
        }
    }

    function processLeave(index, newStatus) {
        let allRequests = JSON.parse(localStorage.getItem("allLeaveRequests")) || [];
        allRequests[index].status = newStatus;
        allRequests[index].adminFinalized = true; // Flag for final approval
        localStorage.setItem("allLeaveRequests", JSON.stringify(allRequests));
        alert("Admin has finalized the request as: " + newStatus);
        displayAdminLeaves();
    }

    function deleteLeaveRequest(index) {
        if(confirm("Delete this request record permanently?")) {
            let allRequests = JSON.parse(localStorage.getItem("allLeaveRequests")) || [];
            allRequests.splice(index, 1);
            localStorage.setItem("allLeaveRequests", JSON.stringify(allRequests));
            displayAdminLeaves();
        }
    }

    function generateReport(type, action) {
        const dailyVal = document.getElementById("reportDailyDate").value;
        const dailyShiftVal = document.getElementById("reportDailyShift").value;
        const monthlyVal = document.getElementById("reportMonthlyDate").value;
        const resultBody = document.getElementById("reportResultBody");
        const resultArea = document.getElementById("reportResultArea");
        const titleDisplay = document.getElementById("reportTitleDisplay");

        if(type === 'daily' && !dailyVal) return alert("Please select a date");
        if(type === 'monthly' && !monthlyVal) return alert("Please select a month");

        resultBody.innerHTML = "";
        const historyRows = document.querySelectorAll("#adminAttendanceTable tbody tr");
        let foundRecords = 0;

        historyRows.forEach(row => {
            const dateStr = row.cells[1].textContent;
            const shiftText = row.cells[3].textContent;
            
            const [m, d, y] = dateStr.split("/");
            const rowISO = `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}`;
            const rowMonthISO = `${y}-${m.padStart(2, '0')}`;

            let dateMatch = (type === 'daily' && rowISO === dailyVal) || (type === 'monthly' && rowMonthISO === monthlyVal);
            
            let shiftMatch = true;
            if (type === 'daily' && dailyShiftVal !== "All Shifts") {
                if (!shiftText.includes(dailyShiftVal)) shiftMatch = false;
            }

            if (dateMatch && shiftMatch) {
                const newRow = row.cloneNode(true);
                if(newRow.lastElementChild) newRow.removeChild(newRow.lastElementChild);
                resultBody.appendChild(newRow);
                foundRecords++;
            }
        });

        // NEW LOGIC: Show Summary
        const staffList = JSON.parse(localStorage.getItem("staffList")) || [];
        document.getElementById("reportSummary").style.display = "block";
        document.getElementById("sumTotalPresent").innerHTML = `<strong>Total Hits:</strong> ${foundRecords}`;
        let rate = staffList.length > 0 ? ((foundRecords / staffList.length) * 100).toFixed(1) : 0;
        document.getElementById("sumAttendanceRate").innerHTML = `<strong>Target Coverage:</strong> ${rate}%`;

        if(foundRecords === 0) {
            resultBody.innerHTML = "<tr><td colspan='7' style='text-align:center;'>No records found.</td></tr>";
        }

        titleDisplay.innerText = type === 'daily' 
            ? `DAILY ATTENDANCE SHEET: ${dailyVal} (${dailyShiftVal})` 
            : `MONTHLY REPORT: ${monthlyVal}`;
            
        resultArea.style.display = "block";
        if(action === 'pdf') setTimeout(() => { window.print(); }, 300);
    }

    function updateStats() {
        const staffList = JSON.parse(localStorage.getItem("staffList")) || [];
        const today = new Date().toLocaleDateString();
        let presentCount = 0;
        let secondShiftCount = 0;

        staffList.forEach(staff => {
            const logs = JSON.parse(localStorage.getItem("attendance_" + staff.empID)) || [];
            if (logs.some(log => log.date === today)) presentCount++;
            if (logs.some(log => log.date === today && log.shift && log.shift.includes("2nd"))) secondShiftCount++;
        });

        document.getElementById("statTotalStaff").innerText = staffList.length;
        document.getElementById("statPresent").innerText = presentCount;
        document.getElementById("statAbsent").innerText = Math.max(0, staffList.length - presentCount);
        document.getElementById("statSecondShift").innerText = secondShiftCount;
    }

    function filterAttendance() {
        const nameVal = document.getElementById("filterName").value.toLowerCase();
        const idVal = document.getElementById("filterID").value.toLowerCase();
        const floorVal = document.getElementById("filterFloor").value;
        const shiftVal = document.getElementById("filterShift").value;
        const dateVal = document.getElementById("filterSpecificDate").value; 
        
        const tr = document.getElementById("adminAttendanceTable").getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
            let showRow = true;
            const tdNameID = tr[i].cells[0].textContent.toLowerCase();
            const tdDateRaw = tr[i].cells[1].textContent; 
            const tdFloor = tr[i].cells[2].textContent;
            const tdShift = tr[i].cells[3].textContent;

            let formattedTdDate = "";
            if (tdDateRaw) {
                const [m, d, y] = tdDateRaw.split("/");
                formattedTdDate = `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}`;
            }

            if (!tdNameID.includes(nameVal) || !tdNameID.includes(idVal)) showRow = false;
            if (floorVal && tdFloor !== floorVal) showRow = false;
            if (shiftVal && !tdShift.includes(shiftVal === "2nd Shift" ? "2nd" : shiftVal)) showRow = false;
            if (dateVal && formattedTdDate !== dateVal) showRow = false;

            tr[i].style.display = showRow ? "" : "none";
        }
    }

    function clearFilters() {
        document.getElementById("filterName").value = "";
        document.getElementById("filterID").value = "";
        document.getElementById("filterFloor").value = "";
        document.getElementById("filterShift").value = "";
        document.getElementById("filterSpecificDate").value = "";
        filterAttendance();
    }

    window.onload = function() { 
        if(typeof displayStaffList === "function") displayStaffList();
        if(typeof displayAllAttendance === "function") displayAllAttendance();
        updateStats(); 
        setInterval(updateStats, 5000); 
    };
</script>
</body>
</html>
